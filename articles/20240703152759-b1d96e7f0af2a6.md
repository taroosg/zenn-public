---
title: "Fresh ã§ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã®ã¿ Basic èªè¨¼ã‚’å‹•ã‹ã—ãŸã„"
emoji: "ğŸ‘¾"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["deno", "fresh"]
published: true
---

## çŠ¶æ³

- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã«ãƒ¦ãƒ¼ã‚¶ãƒšãƒ¼ã‚¸ã¨ç®¡ç†è€…ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹ï¼

- ç®¡ç†è€…ãƒšãƒ¼ã‚¸ã®ã¿ Basic èªè¨¼ã‚’å‹•ã‹ã—ãŸã„ï¼

## è§£æ±ºç­–

Fresh ã«ã¯ middleware æ©Ÿèƒ½ãŒå­˜åœ¨ã™ã‚‹ï¼ã“ã‚Œã‚’ç”¨ã„ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ç¯„å›²ã‚’çµã£ã¦èªè¨¼ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã‚‹ï¼

å‚è€ƒï¼š [https://fresh.deno.dev/docs/concepts/middleware](https://fresh.deno.dev/docs/concepts/middleware)

ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è€ƒãˆã‚‹ï¼ˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä»¥å¤–ã¯çœç•¥ï¼‰ï¼

```txt
.
â””â”€â”€ routes
    â”œâ”€â”€ admin
    â”‚   â”œâ”€â”€ [id].ts
    â”‚   â””â”€â”€ index.ts
    â”œâ”€â”€ [name].tsx
    â”œâ”€â”€ api
    â”‚   â””â”€â”€ joke.ts
    â””â”€â”€ index.tsx
```

`admin` ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒˆã«èªè¨¼ã‚’ã‹ã‘ãŸã„ã¨ã™ã‚‹å ´åˆï¼Œ`admin` ä»¥ä¸‹ã« `_middleware.ts` ã‚’ä½œæˆã—ï¼Œä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜è¿°ã™ã‚‹ï¼

```ts
// routes/admin/_middleware.ts

import { MiddlewareHandlerContext } from "$fresh/server.ts";

interface State {
  data: string;
}

export async function handler(
  req: Request,
  ctx: MiddlewareHandlerContext<State>
) {
  // ğŸ”½ ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š
  const user = "admin";
  const password = "password";

  // ğŸ”½ èªè¨¼ã‚’å‹•ã‹ã™ã‚³ãƒ¼ãƒ‰
  if (
    req.headers.get("Authorization") !== `Basic ${btoa(`${user}:${password}`)}`
  ) {
    const headers = new Headers({
      "WWW-Authenticate": 'Basic realm="Fake Realm"',
    });
    return new Response("Unauthorized", { status: 401, headers });
  }
  ctx.state.data = "myData";
  const resp = await ctx.next();
  resp.headers.set("server", "fresh server");
  return resp;
}
```

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ï¼Œ`admin` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã®ã¿ã§èªè¨¼ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã‚‹ï¼

åŒæ§˜ã«ä»–ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ã‚‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†ã‘ã‚‹ã“ã¨ã§åˆ¥ã€…ã® middleware ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‹•ã‹ã—ã¦ï¼Œç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§èªè¨¼ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã‚‹ï¼

## ã¾ã¨ã‚

middleware æ©Ÿèƒ½ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ä»»æ„ã®ç¯„å›²ã«èªè¨¼ã‚’ã‹ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼

ä»¥ä¸Šã ( `ï½¥Ï‰ï½¥)b
